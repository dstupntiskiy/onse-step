<div class="dialog">
    <div class="event-dialog-header">
        <div>
            <span class="event-day">{{ day }}</span>
        </div>
    </div>
    <div class="fields-row">
        <mat-form-field class="input event-name">
            <mat-label>Название</mat-label>
            <input matInput placeholder="Название" [formControl]="name">
        </mat-form-field>
        <div class="color-wrapper">
            <button (click)="isColorSelectorOpen = !isColorSelectorOpen" class="color-selector" 
                [style.background-color]="color"
                cdkOverlayOrigin #trigger="cdkOverlayOrigin"></button>
            <ng-template
                cdkConnectedOverlay
                [cdkConnectedOverlayOrigin]="trigger"
                [cdkConnectedOverlayOpen]="isColorSelectorOpen">
                <app-palette (onColorSelect)="colorSelected($event)"></app-palette>
            </ng-template>
        </div>
    </div>
    <div class="fields-row">
        <mat-checkbox [formControl]="isRecur" (change)="changeIsRecur($event.checked)">
            Еженедельное событие
        </mat-checkbox>
        <ng-container *ngIf="isRecur?.value">
            <mat-form-field class="event-start">
                <mat-label>Дни недели</mat-label>
                <mat-select  [formControl]="weekdays" multiple>
                    @for (option of weekDaysList; track option){
                        <mat-option [value]="option">{{option.name}}</mat-option>
                    }
                </mat-select>
            </mat-form-field>
        </ng-container>
    </div>
    <ng-container *ngIf="isRecur?.value">
        <div class="fields-row">
            <mat-form-field class="recur-start">
                <mat-label>Дата старта</mat-label>
                <input matInput [matDatepicker]="pickerStart" [formControl]="recurStart">
                <mat-datepicker-toggle matIconSuffix [for]="pickerStart"></mat-datepicker-toggle>
                <mat-datepicker #pickerStart></mat-datepicker>
            </mat-form-field>
            <mat-form-field class="recur-end">
                <mat-label>Дата окончания</mat-label>
                <input matInput [matDatepicker]="pickerEnd" [formControl]="recurEnd">
                <mat-datepicker-toggle matIconSuffix [for]="pickerEnd"></mat-datepicker-toggle>
                <mat-datepicker #pickerEnd></mat-datepicker>
            </mat-form-field>
        </div>
    </ng-container>
    <div class="fields-row period">
        <mat-form-field class="event-start">
            <mat-label>Время начала</mat-label>
            <mat-select  [formControl]="start" >
                @for (option of timeOptions; track option){
                    <mat-option [value]="option">{{option}}</mat-option>
                }
            </mat-select>
        </mat-form-field>
        <mat-form-field class="event-end">
            <mat-label>Время окончания</mat-label>
            <mat-select [formControl]="end" >
                @for (option of timeOptions; track option){
                    <mat-option [value]="option">{{option}}</mat-option>
                }
            </mat-select>
        </mat-form-field>
    </div>
    <div class="fields-row">
        <mat-form-field class="input coach">
            <mat-label>Тренер</mat-label>
            <mat-select  [formControl]="coach" >
                @for (option of coaches; track option){
                    <mat-option [value]="option">{{option.name}}</mat-option>
                }
            </mat-select>
        </mat-form-field>
    </div>
    <div class="fields-row group">
        <mat-form-field class="event-group">
            <mat-label>Группа</mat-label>
            <mat-select [formControl]="group" >
                @for (option of groups; track option){
                    <mat-option [value]="option">{{option.name}}</mat-option>
                }
            </mat-select>
        </mat-form-field>
        @if(!isNew &&!!group.value){
            <mat-icon (click)="onEditGroupClick()" class="edit-group-button">edit</mat-icon>
        }
    </div>
    @if(!isNew && !!group){
        <div class="participants" >
            <a (click)="onParticipantsClick()">Участники группы: {{participantsCount}}/{{ groupParticipantsCount }}</a>
            <a (click)="onOnetimeVisitorsClick()">Разовые посещения: {{ onetimeVisitorsCount }}</a>
        </div>
    }
    <div class="actions" mat-dialog-actions>
        <div class="actions-left">
            <button *ngIf="!isNew" mat-raised-button color="warn" (click)="onDelete()">Удалить</button>
        </div>
        <div class="actions-right">
            <button mat-button (click)="onCloseClick()">Закрыть</button>
            <button mat-raised-button color="accent" (click)="submit()">Сохранить</button>
        </div>
    </div>
</div>